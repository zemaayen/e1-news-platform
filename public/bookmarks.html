<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookmarks - E1 News</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Ccircle cx='100' cy='100' r='100' fill='%23e30613'/%3E%3Ctext x='100' y='140' font-family='Times New Roman,serif' font-size='120' font-weight='900' fill='white' text-anchor='middle' letter-spacing='-5'%3EE1%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <div class="datetime-display">
                    <span id="currentDate"></span>
                    <span class="separator">|</span>
                    <span id="currentTime"></span>
                </div>
            </div>
            <div class="top-bar-right">
                <div id="userInfo"></div>
                <div class="language-switcher">
                    <button class="lang-btn active" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="am">·ä†·àõ</button>
                    <button class="lang-btn" data-lang="he">◊¢◊ë</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="/" class="nav-brand">
                <div class="logo-wrapper">
                    <div class="logo-main">
                        <span class="logo-text">E1</span>
                    </div>
                    <span class="logo-subtitle">NEWS</span>
                </div>
            </a>
            <ul class="nav-menu">
                <li><a href="/">Home</a></li>
                <li><a href="/bookmarks.html" class="active">My Bookmarks</a></li>
                <li><a href="/profile.html">Profile</a></li>
            </ul>
        </div>
    </nav>

    <!-- Bookmarks Container -->
    <div class="bookmarks-container">
        <div class="bookmarks-header">
            <h1>
                üîñ My Bookmarks
                <span class="bookmarks-count" id="bookmarkCount">0 articles</span>
            </h1>
            <p style="color: var(--text-secondary); font-size: 1.1rem; margin-top: 10px;">
                Your saved articles for later reading
            </p>
        </div>

        <div id="bookmarksContent">
            <!-- Bookmarks will be loaded here -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2025 <span id="footerSiteName">E1</span>. All rights reserved.</p>
                <p>Your trusted source for news</p>
            </div>
        </div>
    </footer>

    <script>
        // Check authentication
        const token = localStorage.getItem('token');
        if (!token) {
            alert('Please login to view your bookmarks');
            window.location.href = '/login.html';
        }

        // Date and Time Display
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
        }
        updateDateTime();
        setInterval(updateDateTime, 1000);

        // Load user info
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const userInfo = document.getElementById('userInfo');
                    userInfo.innerHTML = `
                        <span style="color: white; margin-right: 10px;">üë§ ${data.user.fullName || data.user.username}</span>
                        <button onclick="logout()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 15px; border-radius: 5px; cursor: pointer;">Logout</button>
                    `;
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userRole');
            window.location.href = '/login.html';
        }

        // Load bookmarks
        async function loadBookmarks() {
            try {
                const response = await fetch('/api/bookmarks', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load bookmarks');
                }
                
                const data = await response.json();
                const bookmarks = data.bookmarks;
                
                // Update count
                document.getElementById('bookmarkCount').textContent = 
                    `${bookmarks.length} ${bookmarks.length === 1 ? 'article' : 'articles'}`;
                
                const container = document.getElementById('bookmarksContent');
                
                if (bookmarks.length === 0) {
                    container.innerHTML = `
                        <div class="no-bookmarks">
                            <div class="no-bookmarks-icon">üìö</div>
                            <h3>No bookmarks yet</h3>
                            <p>Start bookmarking articles you want to read later!</p>
                            <a href="/" style="display: inline-block; margin-top: 20px; padding: 12px 30px; background: var(--n12-red); color: white; text-decoration: none; border-radius: 25px; font-weight: 600;">
                                Browse Articles
                            </a>
                        </div>
                    `;
                    return;
                }
                
                // Render bookmarked articles
                const bookmarksHTML = `
                    <div class="bookmarks-grid">
                        ${bookmarks.map(bookmark => {
                            const article = bookmark.article;
                            const savedDate = new Date(bookmark.createdAt).toLocaleDateString('en-US', {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric'
                            });
                            
                            return `
                                <div class="article-card" style="position: relative;">
                                    <button class="bookmark-btn bookmarked" onclick="removeBookmark(event, ${article.id})" title="Remove bookmark">
                                        <svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                        </svg>
                                    </button>
                                    <div onclick="viewArticle(${article.id})" style="cursor: pointer;">
                                        ${article.imageUrl ? `<img src="${article.imageUrl}" alt="${article.title}">` : ''}
                                        <div class="article-card-content">
                                            <span class="article-category">${article.category}</span>
                                            <h3>${article.title}</h3>
                                            <p>${article.content.substring(0, 150)}...</p>
                                            <div class="article-meta">
                                                <span>üìÖ Saved: ${savedDate}</span>
                                                <span>üëÅÔ∏è ${article.views} views</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                container.innerHTML = bookmarksHTML;
            } catch (error) {
                console.error('Error loading bookmarks:', error);
                document.getElementById('bookmarksContent').innerHTML = `
                    <div class="no-bookmarks">
                        <div class="no-bookmarks-icon">‚ö†Ô∏è</div>
                        <h3>Error loading bookmarks</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // Remove bookmark
        async function removeBookmark(event, articleId) {
            event.stopPropagation();
            
            if (!confirm('Remove this article from bookmarks?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/bookmarks/${articleId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    // Reload bookmarks
                    loadBookmarks();
                    showToast('Bookmark removed', 'success');
                } else {
                    throw new Error('Failed to remove bookmark');
                }
            } catch (error) {
                console.error('Error removing bookmark:', error);
                showToast('Error removing bookmark', 'error');
            }
        }

        // View article
        function viewArticle(id) {
            window.location.href = `/article.html?id=${id}`;
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: ${type === 'success' ? '#28a745' : '#dc3545'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideInUp 0.3s ease;
                font-weight: 500;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutDown 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // Load site settings
        async function loadSiteSettings() {
            try {
                const response = await fetch('/api/settings');
                const data = await response.json();
                const settings = data.settings;
                
                const siteName = settings.siteName || 'E1';
                document.title = `My Bookmarks - ${siteName} News`;
                
                const footerSiteName = document.getElementById('footerSiteName');
                if (footerSiteName) {
                    footerSiteName.textContent = siteName;
                }
            } catch (error) {
                console.error('Error loading site settings:', error);
            }
        }

        // Initialize page
        loadUserInfo();
        loadBookmarks();
        loadSiteSettings();
        
        // Add animations CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInUp {
                from { transform: translateY(100%); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            @keyframes slideOutDown {
                from { transform: translateY(0); opacity: 1; }
                to { transform: translateY(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

